<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strateji Olu≈ütur - AI Satƒ±≈ü Stratejisi Projesi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        :root {
            /* Semantic UI Teknolojik Design System */
            --primary-blue: #2185d0;
            --primary-blue-light: #54c8ff;
            --primary-blue-dark: #1678c2;
            --secondary-violet: #6435c9;
            --secondary-violet-light: #a333c8;
            --secondary-violet-dark: #5829bb;
            --accent-teal: #00b5ad;
            --accent-green: #21ba45;
            
            /* Teknolojik Neutral Colors */
            --white: #ffffff;
            --gray-light: #1e1e1e;
            --gray-100: #2d3748;
            --gray-200: #4a5568;
            --gray-300: #718096;
            --gray-400: #a0aec0;
            --gray-500: #cbd5e0;
            --gray-600: #e2e8f0;
            --gray-700: #edf2f7;
            --gray-800: #f7fafc;
            --gray-900: #ffffff;
            
            /* Background Colors - Dark Tech Theme */
            --bg-primary: #1a1a1a;
            --bg-card: rgba(45, 55, 72, 0.9);
            --bg-sidebar-active: rgba(33, 133, 208, 0.2);
            --bg-hero-gradient: linear-gradient(135deg, #2185d0 0%, #6435c9 100%);
            
            /* Status Colors - Semantic UI */
            --success: #21ba45;
            --warning: #fbbd08;
            --error: #db2828;
            --info: #2185d0;
            
            /* Typography */
            --font-primary: 'Inter', system-ui, -apple-system, sans-serif;
            --font-headings: 'Inter', system-ui, sans-serif;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --spacing-3xl: 4rem;
            
            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Teknolojik Glow Shadows */
            --shadow-sm: 0 1px 3px 0 rgba(33, 133, 208, 0.1);
            --shadow-base: 0 1px 3px 0 rgba(33, 133, 208, 0.15), 0 1px 2px 0 rgba(33, 133, 208, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(33, 133, 208, 0.2), 0 2px 4px -1px rgba(33, 133, 208, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(33, 133, 208, 0.25), 0 4px 6px -2px rgba(33, 133, 208, 0.15);
            --shadow-xl: 0 20px 25px -5px rgba(33, 133, 208, 0.3), 0 10px 10px -5px rgba(33, 133, 208, 0.2);
            --shadow-card: 0 8px 32px rgba(33, 133, 208, 0.15);
            
            /* Glow Effects */
            --glow-primary: 0 0 20px rgba(33, 133, 208, 0.4);
            --glow-secondary: 0 0 15px rgba(100, 53, 201, 0.3);
            --glow-accent: 0 0 15px rgba(0, 181, 173, 0.3);
            
            /* Teknolojik Accent Colors */
            --tech-cyan: #00d4aa;
            --tech-orange: #f2711c;
            --tech-pink: #e03997;
            --tech-yellow: #fbbd08;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--white) !important;
            line-height: 1.6;
        }
        
        /* T√ºm yazƒ±larƒ± beyaz yap */
        * {
            color: var(--white) !important;
        }
        
        /* √ñzel durumlar i√ßin override */
        input, select, textarea, button {
            color: var(--white) !important;
            background-color: var(--bg-card) !important;
        }
        
        /* Div, span, p ve t√ºm text elementleri i√ßin kesin beyaz */
        div, span, p, h1, h2, h3, h4, h5, h6, label, strong, em, i, b {
            color: var(--white) !important;
        }
        
        /* Loading ve error durumlarƒ± */
        .loading, .error, .success {
            color: var(--white) !important;
        }
        
        /* Metric kutucuklarƒ± */
        .metric, .metric h5, .metric p {
            color: var(--white) !important;
        }
        
        /* Butonlar i√ßin √∂zel renkler */
        .btn-primary, .btn-secondary, .continue-btn {
            background-color: var(--primary-blue) !important;
            color: var(--white) !important;
            border: 1px solid var(--primary-blue) !important;
        }
        
        .btn-outline {
            background-color: transparent !important;
            color: var(--white) !important;
            border: 2px solid var(--primary-blue) !important;
        }
        
        /* Tag'ler i√ßin */
        .tag, .category-tag {
            background-color: var(--primary-blue) !important;
            color: var(--white) !important;
        }
        .strategy-container {
            padding: var(--spacing-xl);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .strategy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-2xl);
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            padding: var(--spacing-xl);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-card);
        }

        .strategy-header h1 {
            color: var(--white);
            font-family: var(--font-headings);
            font-weight: 700;
        }

        .btn-back {
            background: var(--primary-blue);
            color: var(--white);
            text-decoration: none;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-lg);
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid var(--gray-200);
        }

        .btn-back:hover {
            background: var(--white);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .product-info {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--gray-200);
        }
        
        .product-info h3 {
            margin-top: 0;
            color: var(--white);
            font-family: var(--font-headings);
            font-weight: 600;
        }
        
        .product-info p,
        .product-info strong {
            color: var(--white) !important;
        }
        
        .analysis-section {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--gray-200);
        }
        
        .analysis-section h4 {
            margin-top: 0;
            color: var(--white);
            border-bottom: 2px solid var(--primary-blue);
            padding-bottom: var(--spacing-md);
            font-family: var(--font-headings);
            font-weight: 600;
        }
        
        .analysis-section p,
        .analysis-section strong,
        .analysis-section div {
            color: var(--white) !important;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-400);
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .loading.active-step {
            opacity: 1;
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(33, 133, 208, 0.1) 100%);
            border: 2px solid var(--primary-blue);
            border-radius: 10px;
            margin: 10px;
            transform: scale(1.02);
            box-shadow: var(--glow-primary);
        }

        .loading.active-step p {
            color: var(--white) !important;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .loading .spinner {
            border: 4px solid var(--gray-300);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .loading.active-step .spinner {
            border-top-color: var(--primary-blue);
            border-width: 5px;
            width: 50px;
            height: 50px;
            animation: spin 0.8s linear infinite;
            box-shadow: var(--glow-primary);
        }

        .loading.completed {
            opacity: 0.8;
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(33, 181, 69, 0.1) 100%);
            border: 2px solid var(--success);
        }

        .loading.completed p {
            color: var(--success) !important;
            font-weight: normal;
        }

        .loading.completed .spinner {
            display: none;
        }

        .loading.completed::before {
            content: "‚úÖ";
            font-size: 2rem;
            display: block;
            margin-bottom: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .strategy-result {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-card);
            margin-bottom: var(--spacing-xl);
            border: 1px solid var(--gray-200);
        }
        
        .strategy-result h3 {
            margin-top: 0;
            margin-bottom: var(--spacing-xl);
            color: var(--white);
            font-family: var(--font-headings);
            font-weight: 700;
            font-size: 1.4rem;
            text-align: center;
            padding: var(--spacing-lg);
            background: var(--primary-blue);
            border-radius: var(--radius-xl);
            border: 1px solid var(--primary-blue);
        }
        
        .strategy-content {
            line-height: 1.6;
            color: var(--white);
            font-size: 0.95rem;
            background: var(--bg-card);
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(33, 133, 208, 0.2);
        }
        
        .strategy-content h1,
        .strategy-content h2,
        .strategy-content h3,
        .strategy-content h4,
        .strategy-content p,
        .strategy-content strong,
        .strategy-content em {
            color: var(--white) !important;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric {
            background: var(--bg-card) !important;
            border: 1px solid rgba(33, 133, 208, 0.2) !important;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }
        
        .metric h5 {
            margin: 0 0 10px 0;
            color: var(--white);
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        .metric p {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--white);
        }
        
        .btn-back {
            background: #6c757d;
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .btn-back:hover {
            background: #5a6268;
            color: white;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }

        /* Product Selection Styles */
        .product-selection {
            margin-bottom: 30px;
        }

        .product-card {
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-card);
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(10px);
        }

        .product-card:hover {
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .product-card.selected {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(33, 133, 208, 0.2) 100%);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(10px);
        }
        
        .product-card h5,
        .product-card p,
        .product-card strong {
            color: var(--white) !important;
        }
        
        /* Product selection i√ßin √∂zel kurallar */
        .product-selection h4,
        .product-selection p,
        .product-selection strong,
        .product-selection span,
        .product-selection div {
            color: var(--white) !important;
        }
        
        /* Product card i√ßindeki t√ºm elementler */
        .product-card * {
            color: var(--white) !important;
        }
        
        /* Product card header ve content */
        .product-card-header h5,
        .product-card-content p,
        .product-card-meta span {
            color: var(--white) !important;
        }

        .product-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .product-card h5 {
            margin: 0;
            color: var(--white) !important;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .product-card .product-category {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .product-card p {
            margin: 5px 0;
            color: var(--white) !important;
            font-size: 0.9rem;
            opacity: 1;
        }

        .product-card .product-price {
            font-weight: bold;
            color: #27ae60;
        }

        .product-selection-actions {
            text-align: center;
            margin-top: 20px;
        }

        /* √úr√ºn bilgileri ve analiz metinlerinin rengi */
        .product-info p {
            color: var(--white) !important;
        }

        .product-info h3 {
            color: var(--white) !important;
        }

        .analysis-section p {
            color: var(--white) !important;
        }

        .analysis-section strong {
            color: var(--white) !important;
        }

        /* Mesajla≈üma analizi metinleri */
        #messagingAnalysis p {
            color: var(--white) !important;
        }

        #messagingAnalysis strong {
            color: var(--white) !important;
        }

        /* Diƒüer analiz b√∂l√ºmleri i√ßin de aynƒ± stil */
        #marketAnalysis p,
        #customerAnalysis p,
        #pricingAnalysis p {
            color: var(--white) !important;
        }

        #marketAnalysis strong,
        #customerAnalysis strong,
        #pricingAnalysis strong {
            color: var(--white) !important;
        }

        /* Strateji i√ßeriƒüi formatlamasƒ± */
        .strategy-content h2 {
            color: #667eea;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        .strategy-content h3 {
            color: var(--white);
            margin-top: 1.25rem;
            margin-bottom: 0.75rem;
            font-family: 'Poppins', sans-serif;
            font-size: 1.25rem;
        }

        .strategy-content h4 {
            color: #34495e;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
        }

        .strategy-content p {
            color: var(--white);
            margin-bottom: 1rem;
            line-height: 1.6;
            text-align: justify;
        }

        .strategy-content ul {
            color: var(--white);
            margin-bottom: 1rem;
            margin-left: 1.5rem;
        }

        .strategy-content li {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .strategy-content strong {
            color: var(--white);
            font-weight: 600;
        }

        .strategy-content em {
            color: var(--gray-600);
            font-style: italic;
        }

        /* Professional Strategy Content Typography */
        .strategy-content h1 {
            color: var(--gray-900);
            font-family: var(--font-headings);
            font-size: 1.4rem;
            font-weight: 700;
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-md);
            text-align: left;
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--gray-300);
        }

        .strategy-content h2 {
            color: var(--gray-800);
            font-family: var(--font-headings);
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            padding-left: var(--spacing-md);
            border-left: 3px solid var(--gray-600);
            background: var(--gray-50);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-sm);
        }

        .strategy-content h3 {
            color: var(--gray-700);
            font-family: var(--font-headings);
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            position: relative;
        }

        .strategy-content h3::before {
            content: "‚Ä¢";
            color: var(--gray-600);
            margin-right: var(--spacing-sm);
            font-size: 1em;
            font-weight: bold;
        }

        .strategy-content h4 {
            color: var(--gray-700);
            font-family: var(--font-headings);
            font-size: 1rem;
            font-weight: 600;
            margin-top: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
        }

        .strategy-content p {
            margin-bottom: var(--spacing-md);
            text-align: justify;
            text-indent: var(--spacing-sm);
            hyphens: auto;
        }

        .strategy-content p:first-of-type {
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray-800);
            text-indent: 0;
            background: var(--gray-100);
            padding: var(--spacing-md);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--gray-600);
        }

        .strategy-content ul {
            margin-bottom: var(--spacing-lg);
            margin-left: var(--spacing-xl);
            background: var(--gray-50);
            padding: var(--spacing-lg);
            border-radius: var(--radius-sm);
            border-left: 2px solid var(--gray-400);
        }

        .strategy-content li {
            margin-bottom: var(--spacing-sm);
            line-height: 1.6;
            position: relative;
        }

        .strategy-content li::marker {
            color: var(--gray-600);
            font-weight: bold;
        }

        .strategy-content strong {
            color: var(--gray-900);
            font-weight: 600;
            background: var(--gray-100);
            padding: 0 var(--spacing-xs);
            border-radius: var(--radius-sm);
        }

        .strategy-content blockquote {
            background: var(--gray-100);
            border-left: 3px solid var(--gray-500);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
            border-radius: var(--radius-sm);
            font-style: italic;
            color: var(--gray-700);
        }

        /* Action Buttons Styling */
        .strategy-actions {
            display: flex;
            gap: var(--spacing-lg);
            justify-content: center;
            margin-top: var(--spacing-2xl);
            padding-top: var(--spacing-xl);
            border-top: 2px solid var(--gray-200);
        }

        .strategy-actions .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-family: var(--font-headings);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .strategy-actions .btn:first-child {
            background: var(--gray-800);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .strategy-actions .btn:first-child:hover {
            background: var(--gray-900);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .strategy-actions .btn-outline {
            background: transparent;
            color: var(--gray-700);
            border: 2px solid var(--gray-400);
        }

        .strategy-actions .btn-outline:hover {
            background: var(--gray-100);
            color: var(--gray-900);
            border-color: var(--gray-600);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
    </style>
</head>
<body>
    <div class="container">

        <main class="strategy-container">
            <div class="strategy-header">
                <h1>Strateji Olu≈ütur</h1>
                <a href="/dashboard" class="btn-back">‚Üê Dashboard'a D√∂n</a>
            </div>

            <!-- Product Selection Section -->
            <div class="product-selection" id="productSelection" style="display: none;">
                <div class="analysis-section">
                    <h4>üì¶ √úr√ºn Se√ßimi</h4>
                    <p style="margin-bottom: 20px; color: var(--white) !important;">Strateji olu≈üturmak istediƒüiniz √ºr√ºn√º se√ßin:</p>
                    
                    <div id="productSelectionList" class="loading">
                        <div class="spinner"></div>
                        <p>√úr√ºnler y√ºkleniyor...</p>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center; display: none;" id="noProductsMessage">
                        <p style="color: var(--white) !important; margin-bottom: 15px;">Hen√ºz √ºr√ºn eklenmemi≈ü. √ñnce bir √ºr√ºn ekleyin.</p>
                        <a href="/dashboard" class="btn">Dashboard'a D√∂n</a>
                    </div>
                </div>
            </div>

            <div class="product-info" id="productInfo">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>√úr√ºn bilgileri y√ºkleniyor...</p>
                </div>
            </div>

            <div id="analysisContainer" style="display: none;">
                <div class="analysis-grid">
                    <div class="analysis-section">
                        <h4>üìä Pazar Analizi</h4>
                        <div id="marketAnalysis">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Beklemede...</p>
                            </div>
                        </div>
                    </div>

                    <div class="analysis-section">
                        <h4>üéØ Hedef Kitle</h4>
                        <div id="customerAnalysis">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Beklemede...</p>
                            </div>
                        </div>
                    </div>

                    <div class="analysis-section">
                        <h4>üí∞ Fiyatlandƒ±rma</h4>
                        <div id="pricingAnalysis">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Beklemede...</p>
                            </div>
                        </div>
                    </div>

                    <div class="analysis-section" style="display: none;">
                        <h4>‚úçÔ∏è Mesajla≈üma</h4>
                        <div id="messagingAnalysis">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Beklemede...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="strategy-result" id="strategyResult" style="display: none;">
                    <h3>üöÄ √ñnerilen Satƒ±≈ü Stratejisi</h3>
                    <div class="strategy-content" id="strategyContent">
                        <!-- Strateji i√ßeriƒüi buraya gelecek -->
                    </div>
                    
                    <div class="strategy-actions">
                        <button class="btn" onclick="saveStrategy()">
                            <span>üíæ</span>
                            Stratejiyi Kaydet
                        </button>
                        <button class="btn btn-outline" onclick="regenerateStrategy()">
                            <span>üîÑ</span>
                            Yeni Strateji Olu≈ütur
                        </button>
                    </div>
                </div>
            </div>

            <div id="errorContainer" style="display: none;">
                <div class="error-message">
                    <h4>Hata Olu≈ütu</h4>
                    <p id="errorMessage"></p>
                    <button class="btn" onclick="retryAnalysis()">Tekrar Dene</button>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2025 AI Satƒ±≈ü Stratejisi Projesi. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
        </footer>
    </div>

    <script>
        let currentProduct = null;
        let currentStrategy = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '/';
                return;
            }
            
            // URL'den product ID'yi al
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('product_id');
            
            if (!productId) {
                // √úr√ºn ID'si yoksa √ºr√ºn se√ßimi g√∂ster
                showProductSelection();
                return;
            }
            
            // √úr√ºn bilgilerini y√ºkle
            loadProductInfo(productId);
        });

        async function showProductSelection() {
            // √úr√ºn se√ßimi b√∂l√ºm√ºn√º g√∂ster
            document.getElementById('productSelection').style.display = 'block';
            document.getElementById('productInfo').style.display = 'none';
            
            // √úr√ºnleri y√ºkle
            await loadProductsForSelection();
        }

        async function loadProductsForSelection() {
            try {
                const response = await fetch('/api/v1/products/', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });
                
                if (response.ok) {
                    const products = await response.json();
                    displayProductSelection(products);
                } else {
                    showError('√úr√ºnler y√ºklenirken hata olu≈ütu');
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showError('√úr√ºnler y√ºklenirken hata olu≈ütu');
            }
        }

        function displayProductSelection(products) {
            const productList = document.getElementById('productSelectionList');
            const noProductsMessage = document.getElementById('noProductsMessage');
            
            if (products.length === 0) {
                productList.style.display = 'none';
                noProductsMessage.style.display = 'block';
                return;
            }
            
            const productsHTML = products.map(product => `
                <div class="product-card" onclick="selectProduct(${product.id})" data-product-id="${product.id}">
                    <div class="product-card-header">
                        <h5>${product.name}</h5>
                        <span class="product-category">${product.category}</span>
                    </div>
                    <p>${product.description}</p>
                    <p class="product-price">Maliyet: ‚Ç∫${product.cost_price}</p>
                    ${product.target_profit_margin ? `<p>Hedef Kar Marjƒ±: %${(product.target_profit_margin * 100).toFixed(1)}</p>` : ''}
                </div>
            `).join('');
            
            productList.innerHTML = `
                <div style="margin-bottom: 20px;">
                    ${productsHTML}
                </div>
                <div class="product-selection-actions">
                    <button class="btn" id="continueBtn" onclick="continueWithSelectedProduct()" style="display: none;">
                        Se√ßilen √úr√ºn ile Devam Et
                    </button>
                </div>
            `;
        }

        let selectedProductId = null;

        function selectProduct(productId) {
            selectedProductId = productId;
            
            // T√ºm kartlarƒ± temizle
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => card.classList.remove('selected'));
            
            // Se√ßili kartƒ± i≈üaretle
            const selectedCard = document.querySelector(`[data-product-id="${productId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
            
            // Devam et butonunu g√∂ster
            document.getElementById('continueBtn').style.display = 'inline-block';
        }

        function continueWithSelectedProduct() {
            if (!selectedProductId) {
                showNotification('L√ºtfen bir √ºr√ºn se√ßin', 'warning');
                return;
            }
            
            // √úr√ºn se√ßimi b√∂l√ºm√ºn√º gizle
            document.getElementById('productSelection').style.display = 'none';
            document.getElementById('productInfo').style.display = 'block';
            
            // Se√ßilen √ºr√ºn√ºn bilgilerini y√ºkle
            loadProductInfo(selectedProductId);
        }
        
        async function loadProductInfo(productId) {
            try {
                const response = await fetch(`/api/v1/products/${productId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });
                
                if (response.ok) {
                    currentProduct = await response.json();
                    displayProductInfo(currentProduct);
                    
                    // Analizi ba≈ülat
                    setTimeout(() => {
                        startAnalysis();
                    }, 1000);
                } else {
                    showError('√úr√ºn bilgileri y√ºklenemedi');
                }
            } catch (error) {
                console.error('Error loading product:', error);
                showError('√úr√ºn bilgileri y√ºklenirken hata olu≈ütu');
            }
        }
        
        function displayProductInfo(product) {
            const productInfo = document.getElementById('productInfo');
            productInfo.innerHTML = `
                <h3>${product.name}</h3>
                <p><strong>Kategori:</strong> ${product.category}</p>
                <p><strong>A√ßƒ±klama:</strong> ${product.description}</p>
                <p><strong>Maliyet Fiyatƒ±:</strong> ${product.cost_price} TL</p>
                ${product.target_profit_margin ? `<p><strong>Hedef Kar Marjƒ±:</strong> %${(product.target_profit_margin * 100).toFixed(1)}</p>` : ''}
            `;
        }
        
        async function startAnalysis() {
            document.getElementById('analysisContainer').style.display = 'block';
            
            // Sƒ±ralƒ± olarak analizleri ba≈ülat
            await performSequentialAnalysis();
        }

        async function performSequentialAnalysis() {
            try {
                // Global analiz sonu√ßlarƒ±
                window.analysisResults = {};

                // 1. Pazar Analizi
                await setAnalysisStep('marketAnalysis', 'Pazar analizi yapƒ±lƒ±yor...');
                const marketResult = await performMarketAnalysis();
                window.analysisResults.market = marketResult;
                await setAnalysisCompleted('marketAnalysis');

                // 2. Hedef Kitle Belirleme
                await setAnalysisStep('customerAnalysis', 'Hedef kitle belirleniyor...');
                const customerResult = await performCustomerAnalysis();
                window.analysisResults.customer = customerResult;
                await setAnalysisCompleted('customerAnalysis');

                // 3. Fiyatlandƒ±rma Hesaplama
                await setAnalysisStep('pricingAnalysis', 'Fiyatlandƒ±rma hesaplanƒ±yor...');
                const pricingResult = await performPricingAnalysis();
                window.analysisResults.pricing = pricingResult;
                await setAnalysisCompleted('pricingAnalysis');

                // 4. Mesajla≈üma Stratejisi
                await setAnalysisStep('messagingAnalysis', 'Mesajla≈üma stratejisi olu≈üturuluyor...');
                const messagingResult = await performMessagingAnalysis();
                window.analysisResults.messaging = messagingResult;
                await setAnalysisCompleted('messagingAnalysis');

                // 5. Nihai Strateji Olu≈üturma
                await setAnalysisStep('strategyGeneration', 'Nihai strateji olu≈üturuluyor...');
                await generateStrategy();
                
            } catch (error) {
                console.error('Sequential analysis error:', error);
                showError('Analiz sƒ±rasƒ±nda hata olu≈ütu');
            }
        }

        async function setAnalysisStep(stepId, message) {
            // T√ºm adƒ±mlarƒ± pasif yap
            resetAllSteps();
            
            // Mevcut adƒ±mƒ± aktif yap
            const stepElement = document.getElementById(stepId);
            if (stepElement) {
                stepElement.innerHTML = `
                    <div class="loading active-step">
                        <div class="spinner"></div>
                        <p>${message}</p>
                    </div>
                `;
            } else if (stepId === 'strategyGeneration') {
                // Strateji olu≈üturma i√ßin √∂zel alan
                document.getElementById('strategyResult').style.display = 'block';
                document.getElementById('strategyContent').innerHTML = `
                    <div class="loading active-step">
                        <div class="spinner"></div>
                        <p>${message}</p>
                    </div>
                `;
            }
            
            // Kƒ±sa bir bekleme s√ºresi ekle (g√∂rsel efekt i√ßin)
            await new Promise(resolve => setTimeout(resolve, 500));
        }

        async function setAnalysisCompleted(stepId) {
            const stepElement = document.getElementById(stepId);
            if (stepElement) {
                const loadingElement = stepElement.querySelector('.loading');
                if (loadingElement) {
                    // Active step'i completed'e √ßevir
                    loadingElement.classList.remove('active-step');
                    loadingElement.classList.add('completed');
                    
                    // Mesajƒ± g√ºncelle
                    const messageElement = loadingElement.querySelector('p');
                    if (messageElement) {
                        messageElement.textContent = 'Tamamlandƒ±';
                    }
                }
            }
            
            // Kƒ±sa bir bekleme s√ºresi ekle
            await new Promise(resolve => setTimeout(resolve, 500));
        }

        function resetAllSteps() {
            // T√ºm loading'leri pasif yap
            const loadingElements = document.querySelectorAll('.loading');
            loadingElements.forEach(loading => {
                loading.classList.remove('active-step');
            });
        }
        
        async function performMarketAnalysis() {
            // Ger√ßek AI pazar analizi - sadece pazar analizi
            try {
                const response = await fetch(`/api/v1/strategies/analyze/${currentProduct.id}/market`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const marketData = result.result;
                    
                    document.getElementById('marketAnalysis').innerHTML = `
                        <div class="metric">
                            <h5>Pazar B√ºy√ºkl√ºƒü√º</h5>
                            <p>${marketData.market_size || 'Orta'}</p>
                        </div>
                        <div class="metric">
                            <h5>Rekabet Seviyesi</h5>
                            <p>${marketData.competition_level || 'Orta'}</p>
                        </div>
                        <div class="metric">
                            <h5>Talep Skoru</h5>
                            <p>${Math.round((marketData.demand_score || 0.6) * 100)}%</p>
                        </div>
                        <div class="metric">
                            <h5>B√ºy√ºme Potansiyeli</h5>
                            <p>${marketData.growth_potential || 'Orta'}</p>
                        </div>
                    `;
                    
                    return marketData;
                } else if (response.status === 401) {
                    handle401Error();
                    throw new Error('Oturum s√ºresi doldu');
                } else {
                    throw new Error('Pazar analizi ba≈üarƒ±sƒ±z');
                }
            } catch (error) {
                console.error('Pazar analizi hatasƒ±:', error);
                document.getElementById('marketAnalysis').innerHTML = `
                    <div style="color: var(--error); text-align: center; padding: 20px;">
                        <h5>‚ùå Pazar Analizi Hatasƒ±</h5>
                        <p>${error.message || 'Pazar analizi yapƒ±lƒ±rken hata olu≈ütu'}</p>
                    </div>
                `;
                throw error;
            }
        }
        
        async function performCustomerAnalysis() {
            // Ger√ßek AI hedef kitle analizi
            try {
                const response = await fetch(`/api/v1/strategies/analyze/${currentProduct.id}/customer`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const customerData = result.result;
                    const channels = customerData.marketing_channels || customerData.recommended_channels || [];
                    
                    // Kanallarƒ± d√ºzg√ºn formatlama
                    let channelText = 'Dijital kanallar';
                    if (Array.isArray(channels) && channels.length > 0) {
                        channelText = channels.map(channel => {
                            if (typeof channel === 'string') {
                                return channel;
                            } else if (typeof channel === 'object' && channel !== null) {
                                // T√ºm string deƒüerlerini bul
                                const allValues = Object.values(channel)
                                    .filter(value => typeof value === 'string' && value.trim().length > 0);
                                
                                if (allValues.length > 0) {
                                    // En uzun string deƒüeri al (muhtemelen en a√ßƒ±klayƒ±cƒ± olandƒ±r)
                                    return allValues.reduce((longest, current) => 
                                        current.length > longest.length ? current : longest
                                    );
                                }
                                
                                // Eƒüer string deƒüer bulunamazsa, bo≈ü olmayan ilk deƒüeri al
                                const nonEmptyValues = Object.values(channel)
                                    .filter(value => value !== null && value !== undefined && value !== '');
                                
                                if (nonEmptyValues.length > 0) {
                                    return String(nonEmptyValues[0]);
                                }
                                
                                return 'Pazarlama Kanalƒ±';
                            }
                            return String(channel);
                        }).join(', ');
                    }
                    
                    document.getElementById('customerAnalysis').innerHTML = `
                        <div class="metric">
                            <h5>Birincil Hedef</h5>
                            <p>${customerData.primary_segment || 'Genel t√ºketiciler'}</p>
                        </div>
                        <div class="metric">
                            <h5>Ya≈ü Aralƒ±ƒüƒ±</h5>
                            <p>${customerData.age_range || '25-45'}</p>
                        </div>
                        <div class="metric">
                            <h5>√ñnerilen Kanallar</h5>
                            <p>${channelText}</p>
                        </div>
                        <div class="metric">
                            <h5>Fiyat Hassasiyeti</h5>
                            <p>${customerData.price_sensitivity || 'Orta'}</p>
                        </div>
                    `;
                    
                    return customerData;
                } else if (response.status === 401) {
                    handle401Error();
                    throw new Error('Oturum s√ºresi doldu');
                } else {
                    throw new Error('Hedef kitle analizi ba≈üarƒ±sƒ±z');
                }
            } catch (error) {
                console.error('Hedef kitle analizi hatasƒ±:', error);
                document.getElementById('customerAnalysis').innerHTML = `
                    <div style="color: var(--error); text-align: center; padding: 20px;">
                        <h5>‚ùå Hedef Kitle Analizi Hatasƒ±</h5>
                        <p>${error.message || 'Hedef kitle analizi yapƒ±lƒ±rken hata olu≈ütu'}</p>
                    </div>
                `;
                throw error;
            }
        }
        
        async function performPricingAnalysis() {
            // Ger√ßek AI fiyatlandƒ±rma analizi
            try {
                const response = await fetch(`/api/v1/strategies/analyze/${currentProduct.id}/pricing`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const pricingData = result.result;
                    
                    document.getElementById('pricingAnalysis').innerHTML = `
                        <div class="metric">
                            <h5>√ñnerilen Fiyat</h5>
                            <p>${pricingData.recommended_price ? pricingData.recommended_price.toFixed(2) : (currentProduct.cost_price * 1.4).toFixed(2)} TL</p>
                        </div>
                        <div class="metric">
                            <h5>Kar Marjƒ±</h5>
                            <p>%${pricingData.profit_margin ? (pricingData.profit_margin * 100).toFixed(1) : '40'}</p>
                        </div>
                        <div class="metric">
                            <h5>Rekabet Durumu</h5>
                            <p>${pricingData.competitive_position || 'Orta seviye'}</p>
                        </div>
                        <div class="metric">
                            <h5>Fiyat Stratejisi</h5>
                            <p>${pricingData.strategy_type || 'Deƒüer temelli'}</p>
                        </div>
                    `;
                    
                    return pricingData;
                } else if (response.status === 401) {
                    handle401Error();
                    throw new Error('Oturum s√ºresi doldu');
                } else {
                    throw new Error('Fiyatlandƒ±rma analizi ba≈üarƒ±sƒ±z');
                }
            } catch (error) {
                console.error('Fiyatlandƒ±rma analizi hatasƒ±:', error);
                document.getElementById('pricingAnalysis').innerHTML = `
                    <div style="color: var(--error); text-align: center; padding: 20px;">
                        <h5>‚ùå Fiyatlandƒ±rma Analizi Hatasƒ±</h5>
                        <p>${error.message || 'Fiyatlandƒ±rma analizi yapƒ±lƒ±rken hata olu≈ütu'}</p>
                    </div>
                `;
                throw error;
            }
        }

        async function performMessagingAnalysis() {
            // Ger√ßek AI mesajla≈üma stratejisi analizi
            try {
                const response = await fetch(`/api/v1/strategies/analyze/${currentProduct.id}/messaging`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const messagingData = result.result;
                    const keyMessages = messagingData.key_messages || [];
                    
                    document.getElementById('messagingAnalysis').innerHTML = `
                        <div class="metric">
                            <h5>Ana Mesajlar</h5>
                            <p>${Array.isArray(keyMessages) ? keyMessages.join(', ') : 'Kalite, G√ºvenilirlik'}</p>
                        </div>
                        <div class="metric">
                            <h5>Ton & Stil</h5>
                            <p>${messagingData.tone || 'Profesyonel ve samimi'}</p>
                        </div>
                        <div class="metric">
                            <h5>ƒ∞√ßerik Stratejisi</h5>
                            <p>${messagingData.content_strategy || 'Eƒüitici ve problem √ß√∂z√ºc√º'}</p>
                        </div>
                        <div class="metric">
                            <h5>CTA √ñnerisi</h5>
                            <p>${messagingData.call_to_action || 'Hemen ƒ∞ncele'}</p>
                        </div>
                    `;
                    
                    return messagingData;
                } else if (response.status === 401) {
                    handle401Error();
                    throw new Error('Oturum s√ºresi doldu');
                } else {
                    throw new Error('Mesajla≈üma analizi ba≈üarƒ±sƒ±z');
                }
            } catch (error) {
                console.error('Mesajla≈üma analizi hatasƒ±:', error);
                document.getElementById('messagingAnalysis').innerHTML = `
                    <div style="color: var(--error); text-align: center; padding: 20px;">
                        <h5>‚ùå Mesajla≈üma Analizi Hatasƒ±</h5>
                        <p>${error.message || 'Mesajla≈üma analizi yapƒ±lƒ±rken hata olu≈ütu'}</p>
                    </div>
                `;
                throw error;
            }
        }

        // Eski performMessagingAnalysis fonksiyonunu kaldƒ±r
        async function performMessagingAnalysis_OLD() {
            return new Promise(async (resolve) => {
                try {
                    if (window.aiAnalysisResult && window.aiAnalysisResult.messaging_analysis) {
                        const pricingData = window.aiAnalysisResult.pricing_analysis;
                        
                        document.getElementById('pricingAnalysis').innerHTML = `
                            <div class="metric">
                                <h5>√ñnerilen Fiyat</h5>
                                <p>${(pricingData.recommended_price || currentProduct.cost_price * 1.4).toFixed(2)} TL</p>
                            </div>
                            <div class="metric">
                                <h5>Kar Marjƒ±</h5>
                                <p>%${Math.round((pricingData.profit_margin || 0.4) * 100)}</p>
                            </div>
                            <div class="metric">
                                <h5>Rekabet Pozisyonu</h5>
                                <p>${pricingData.competitive_position || 'Rekabet√ßi'}</p>
                            </div>
                        `;
                        resolve(pricingData);
                    } else {
                        // Fallback
                        const costPrice = currentProduct.cost_price;
                        const suggestedPrice = costPrice * 1.4;
                        
                        const analysis = {
                            suggested_price: suggestedPrice,
                            profit_margin: 0.4
                        };
                        
                        document.getElementById('pricingAnalysis').innerHTML = `
                            <div class="metric">
                                <h5>√ñnerilen Fiyat</h5>
                                <p>${suggestedPrice.toFixed(2)} TL</p>
                            </div>
                            <div class="metric">
                                <h5>Kar Marjƒ±</h5>
                                <p>%40</p>
                            </div>
                        `;
                        resolve(analysis);
                    }
                } catch (error) {
                    console.error('Fiyat analizi hatasƒ±:', error);
                    resolve({suggested_price: currentProduct.cost_price * 1.4});
                }
            });
        }
        
        async function performMessagingAnalysis() {
            return new Promise(async (resolve) => {
                try {
                    if (window.aiAnalysisResult && window.aiAnalysisResult.messaging_analysis) {
                        const messagingData = window.aiAnalysisResult.messaging_analysis;
                        const keyMessages = messagingData.key_messages || ['Kalite', 'G√ºvenilirlik'];
                        const toneData = messagingData.tone_of_voice || {};
                        
                        document.getElementById('messagingAnalysis').innerHTML = `
                            <p><strong>Anahtar Mesajlar:</strong> ${keyMessages.join(', ')}</p>
                            <p><strong>Ton:</strong> ${toneData.tone || 'Profesyonel ve samimi'}</p>
                            <p><strong>Stil:</strong> ${toneData.style || 'Anla≈üƒ±lƒ±r dil'}</p>
                        `;
                        resolve(messagingData);
                    } else {
                        // Fallback
                        const analysis = {
                            key_messages: ['Kalite', 'G√ºvenilirlik', 'Uygun fiyat'],
                            tone: 'Profesyonel ve samimi',
                            cta: 'Hemen satƒ±n al'
                        };
                        
                        document.getElementById('messagingAnalysis').innerHTML = `
                            <p><strong>Anahtar Mesajlar:</strong> ${analysis.key_messages.join(', ')}</p>
                            <p><strong>Ton:</strong> ${analysis.tone}</p>
                            <p><strong>Eylem √áaƒürƒ±sƒ±:</strong> ${analysis.cta}</p>
                        `;
                        resolve(analysis);
                    }
                } catch (error) {
                    console.error('Mesajla≈üma analizi hatasƒ±:', error);
                    resolve({key_messages: ['Kalite', 'G√ºvenilirlik']});
                }
            });
        }
        
        function formatStrategyContent(content) {
            if (!content) return 'Strateji i√ßeriƒüi bulunamadƒ±.';
            
            let formatted = content
                // Ba≈ülƒ±klar
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/^#### (.+)$/gm, '<h4>$1</h4>')
                .replace(/^\*\*(.+)\*\*$/gm, '<h3>$1</h3>') // **Ba≈ülƒ±k** formatƒ±
                // Kalƒ±n ve italik yazƒ±lar
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                // Listeler
                .replace(/^\* (.+)$/gm, '<li>$1</li>')
                .replace(/^- (.+)$/gm, '<li>$1</li>')
                // Paragraflar
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');

            // Liste √∂ƒüelerini <ul> ile sar
            formatted = formatted.replace(/(<li>.*<\/li>)/gs, function(match) {
                return '<ul>' + match + '</ul>';
            });

            // Ba≈ülangƒ±√ß ve biti≈ü paragraf etiketleri
            if (!formatted.startsWith('<h') && !formatted.startsWith('<ul')) {
                formatted = '<p>' + formatted;
            }
            if (!formatted.endsWith('</h2>') && !formatted.endsWith('</h3>') && !formatted.endsWith('</ul>')) {
                formatted = formatted + '</p>';
            }

            // Temizlik
            formatted = formatted
                .replace(/<p><\/p>/g, '')
                .replace(/<p>(<h[234]>)/g, '$1')
                .replace(/(<\/h[234]>)<\/p>/g, '$1')
                .replace(/<p>(<ul>)/g, '$1')
                .replace(/(<\/ul>)<\/p>/g, '$1');

            return formatted;
        }

        async function generateStrategy() {
            // Nihai strateji olu≈ütur - t√ºm analiz sonu√ßlarƒ±nƒ± kullan
            try {
                const response = await fetch(`/api/v1/strategies/generate/${currentProduct.id}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        market_data: window.analysisResults?.market || {},
                        customer_data: window.analysisResults?.customer || {},
                        pricing_data: window.analysisResults?.pricing || {},
                        messaging_data: window.analysisResults?.messaging || {}
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const strategyData = result.result;
                    const strategyContent = strategyData.strategy_content;
                    
                    // Loading'i kaldƒ±r ve stratejiyi g√∂ster
                    const formattedContent = formatStrategyContent(strategyContent);
                    document.getElementById('strategyContent').innerHTML = formattedContent;
                    
                    currentStrategy = {
                        title: `${currentProduct.name} Satƒ±≈ü Stratejisi`,
                        content: strategyContent,
                        product_id: currentProduct.id,
                        confidence_score: strategyData.confidence_score || 0.8,
                        expected_roi: strategyData.expected_roi || 0.2,
                        implementation_difficulty: strategyData.implementation_difficulty || 'medium'
                    };
                } else if (response.status === 401) {
                    handle401Error();
                    throw new Error('Oturum s√ºresi doldu');
                } else {
                    throw new Error('Strateji olu≈üturma ba≈üarƒ±sƒ±z');
                }
            } catch (error) {
                console.error('Strateji olu≈üturma hatasƒ±:', error);
                document.getElementById('strategyContent').innerHTML = `
                    <div style="color: var(--error); text-align: center; padding: 20px;">
                        <h5>‚ùå Strateji Olu≈üturma Hatasƒ±</h5>
                        <p>${error.message || 'Strateji olu≈üturulurken hata olu≈ütu'}</p>
                    </div>
                `;
                throw error;
            }
        }
        
        async function saveStrategy() {
            if (!currentStrategy) {
                showNotification('Hen√ºz bir strateji olu≈üturulmamƒ±≈ü', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/v1/strategies/', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(currentStrategy)
                });
                
                if (response.ok) {
                    showNotification('Strateji ba≈üarƒ±yla kaydedildi', 'success');
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 2000);
                } else if (response.status === 401) {
                    handle401Error();
                } else {
                    const error = await response.json();
                    showNotification(error.detail || 'Strateji kaydedilirken hata olu≈ütu', 'error');
                }
            } catch (error) {
                console.error('Error saving strategy:', error);
                showNotification('Strateji kaydedilirken hata olu≈ütu', 'error');
            }
        }
        
        function regenerateStrategy() {
            document.getElementById('strategyResult').style.display = 'none';
            startAnalysis();
        }
        
        function retryAnalysis() {
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('analysisContainer').style.display = 'none';
            startAnalysis();
        }
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorContainer').style.display = 'block';
            document.getElementById('analysisContainer').style.display = 'none';
        }

        // Handle 401 Unauthorized errors
        function handle401Error() {
            showNotification('Oturum s√ºreniz dolmu≈ü. Giri≈ü sayfasƒ±na y√∂nlendiriliyorsunuz...', 'error');
            setTimeout(() => {
                localStorage.removeItem('access_token');
                window.location.href = '/';
            }, 2000);
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
            `;
            
            switch(type) {
                case 'success':
                    notification.style.background = '#27ae60';
                    break;
                case 'error':
                    notification.style.background = '#e74c3c';
                    break;
                case 'warning':
                    notification.style.background = '#f39c12';
                    break;
                default:
                    notification.style.background = '#3498db';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html> 